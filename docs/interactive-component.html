<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Interactive component | US Crime Analysis</title>
  <meta name="description" content="A detaled analysis of crime in the United States" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Interactive component | US Crime Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://vijaykalmath.github.io/USCrimeAnalysis/" />
  <meta property="og:image" content="https://vijaykalmath.github.io/USCrimeAnalysis/./assets/cover.png" />
  <meta property="og:description" content="A detaled analysis of crime in the United States" />
  <meta name="github-repo" content="VijayKalmath/USCrimeAnalysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Interactive component | US Crime Analysis" />
  
  <meta name="twitter:description" content="A detaled analysis of crime in the United States" />
  <meta name="twitter:image" content="https://vijaykalmath.github.io/USCrimeAnalysis/./assets/cover.png" />

<meta name="author" content="Smaranjit Ghose, Soham Joshi, Vijay S Kalmath" />


<meta name="date" content="2021-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="./assets/apple-touch-icon.png" />
  <link rel="shortcut icon" href="./assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">US Crime Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#hate-crime"><i class="fa fa-check"></i><b>1.2</b> HATE CRIME</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#our-proposal"><i class="fa fa-check"></i><b>1.3</b> Our Proposal</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#ucr-hate-crime-data"><i class="fa fa-check"></i><b>2.1</b> UCR Hate Crime Data</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#gun-violence-data"><i class="fa fa-check"></i><b>2.2</b> Gun Violence Data</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#j"><i class="fa fa-check"></i><b>2.3</b> J</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#fbi-uniform-crime-reporting-ucr"><i class="fa fa-check"></i><b>3.1</b> FBI: Uniform Crime Reporting (UCR)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-transformation.html"><a href="data-transformation.html#hate-crime-by-bias"><i class="fa fa-check"></i><b>3.1.1</b> Hate Crime by Bias</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-transformation.html"><a href="data-transformation.html#hate-crime-by-offense-type"><i class="fa fa-check"></i><b>3.1.2</b> Hate Crime by Offense Type</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-transformation.html"><a href="data-transformation.html#hate-crime-by-state"><i class="fa fa-check"></i><b>3.1.3</b> Hate Crime by State</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#gun-violence-data-1"><i class="fa fa-check"></i><b>3.2</b> Gun Violence Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#mass-shootings"><i class="fa fa-check"></i><b>3.2.1</b> Mass Shootings</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-transformation.html"><a href="data-transformation.html#accidental-deaths-and-injuries"><i class="fa fa-check"></i><b>3.2.2</b> Accidental Deaths and Injuries</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#juvenile-arrest-records-jar"><i class="fa fa-check"></i><b>3.3</b> Juvenile Arrest Records (JAR)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing Values</a>
<ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#missing-data-in-juvenile-arrest-records"><i class="fa fa-check"></i><b>4.1</b> Missing Data in Juvenile Arrest Records</a></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#missing-data-in-gun-violence-archive"><i class="fa fa-check"></i><b>4.2</b> Missing Data in Gun Violence Archive</a></li>
<li class="chapter" data-level="4.3" data-path="missing-values.html"><a href="missing-values.html#missing-data-in-hate-crime-data"><i class="fa fa-check"></i><b>4.3</b> Missing Data in Hate Crime Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="missing-values.html"><a href="missing-values.html#hc-by-offense"><i class="fa fa-check"></i><b>4.3.1</b> HC by Offense</a></li>
<li class="chapter" data-level="4.3.2" data-path="missing-values.html"><a href="missing-values.html#hc-by-state"><i class="fa fa-check"></i><b>4.3.2</b> HC by State</a></li>
<li class="chapter" data-level="4.3.3" data-path="missing-values.html"><a href="missing-values.html#hc-by-place"><i class="fa fa-check"></i><b>4.3.3</b> HC by Place</a></li>
<li class="chapter" data-level="4.3.4" data-path="missing-values.html"><a href="missing-values.html#hc-by-age"><i class="fa fa-check"></i><b>4.3.4</b> HC by Age</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a>
<ul>
<li class="chapter" data-level="7.1" data-path="conclusion.html"><a href="conclusion.html#limitations"><i class="fa fa-check"></i><b>7.1</b> Limitations</a></li>
<li class="chapter" data-level="7.2" data-path="conclusion.html"><a href="conclusion.html#scope-of-work"><i class="fa fa-check"></i><b>7.2</b> Scope of Work:</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">US Crime Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Interactive component</h1>
<html>
<head>
<style>
        body {
            font-family: Sans-serif;
            font-size: 11px;
        }

        .slice {
            cursor: pointer;
        }

        .slice .main-arc {
            stroke: #fff;
            stroke-width: 1px;
        }

        .slice .hidden-arc {
            fill: none;
        }

        .slice text {
            pointer-events: none;
            dominant-baseline: middle;
            text-anchor: middle;
        }
    </style>
<script src='https://d3js.org/d3.v4.min.js'></script>
</head>
<body>
<script>
        const width = window.innerWidth,
            height = window.innerHeight,
            maxRadius = (Math.min(width, height) / 2) - 5;

        const formatNumber = d3.format(',d');

        const x = d3.scaleLinear()
            .range([0, 2 * Math.PI])
            .clamp(true);

        const y = d3.scaleSqrt()
            .range([maxRadius*.1, maxRadius]);

        const color = d3.scaleOrdinal(d3.schemeCategory20);

        const partition = d3.partition();

        const arc = d3.arc()
            .startAngle(d => x(d.x0))
            .endAngle(d => x(d.x1))
            .innerRadius(d => Math.max(0, y(d.y0)))
            .outerRadius(d => Math.max(0, y(d.y1)));

        const middleArcLine = d => {
            const halfPi = Math.PI/2;
            const angles = [x(d.x0) - halfPi, x(d.x1) - halfPi];
            const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);

            const middleAngle = (angles[1] + angles[0]) / 2;
            const invertDirection = middleAngle > 0 && middleAngle < Math.PI; // On lower quadrants write text ccw
            if (invertDirection) { angles.reverse(); }

            const path = d3.path();
            path.arc(0, 0, r, angles[0], angles[1], invertDirection);
            return path.toString();
        };

        const textFits = d => {
            const CHAR_SPACE = 6;

            const deltaAngle = x(d.x1) - x(d.x0);
            const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);
            const perimeter = r * deltaAngle;

            return d.data.name.length * CHAR_SPACE < perimeter;
        };

        const svg = d3.select('body').append('svg')
            .style('width', '100vw')
            .style('height', '100vh')
            .attr('viewBox', `${-width / 2} ${-height / 2} ${width} ${height}`)
            .on('click', () => focusOn()); // Reset zoom on canvas click

        d3.json('https://raw.githubusercontent.com/VijayKalmath/USCrimeAnalysis/main/data/Consolidated.json', (error, root) => {
            if (error) throw error;

            root = d3.hierarchy(root);
            root.sum(d => d.size);

            const slice = svg.selectAll('g.slice')
                .data(partition(root).descendants());

            slice.exit().remove();

            const newSlice = slice.enter()
                .append('g').attr('class', 'slice')
                .on('click', d => {
                    d3.event.stopPropagation();
                    focusOn(d);
                });

            newSlice.append('title')
                .text(d => d.data.name + '\n' + formatNumber(d.value));

            newSlice.append('path')
                .attr('class', 'main-arc')
                .style('fill', d => color((d.children ? d : d.parent).data.name))
                .attr('d', arc);

            newSlice.append('path')
                .attr('class', 'hidden-arc')
                .attr('id', (_, i) => `hiddenArc${i}`)
                .attr('d', middleArcLine);

            const text = newSlice.append('text')
                .attr('display', d => textFits(d) ? null : 'none');

            // Add white contour
            text.append('textPath')
                .attr('startOffset','50%')
                .attr('xlink:href', (_, i) => `#hiddenArc${i}` )
                .text(d => d.data.name)
                .style('fill', 'none')
                .style('stroke', '#fff')
                .style('stroke-width', 5)
                .style('stroke-linejoin', 'round');

            text.append('textPath')
                .attr('startOffset','50%')
                .attr('xlink:href', (_, i) => `#hiddenArc${i}` )
                .text(d => d.data.name);
        });

        function focusOn(d = { x0: 0, x1: 1, y0: 0, y1: 1 }) {
            // Reset to top-level if no data point specified

            const transition = svg.transition()
                .duration(750)
                .tween('scale', () => {
                    const xd = d3.interpolate(x.domain(), [d.x0, d.x1]),
                        yd = d3.interpolate(y.domain(), [d.y0, 1]);
                    return t => { x.domain(xd(t)); y.domain(yd(t)); };
                });

            transition.selectAll('path.main-arc')
                .attrTween('d', d => () => arc(d));

            transition.selectAll('path.hidden-arc')
                .attrTween('d', d => () => middleArcLine(d));

            transition.selectAll('text')
                .attrTween('display', d => () => textFits(d) ? null : 'none');

            moveStackToFront(d);

            //

            function moveStackToFront(elD) {
                svg.selectAll('.slice').filter(d => d === elD)
                    .each(function(d) {
                        this.parentNode.appendChild(this);
                        if (d.parent) { moveStackToFront(d.parent); }
                    })
            }
        }
    </script>
</body>
</html>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/VijayKalmath/USCrimeAnalysis/edit/main/06-interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/VijayKalmath/USCrimeAnalysis/blob/main/06-interactive.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
