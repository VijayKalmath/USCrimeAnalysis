--- 
title: "US Crime Analysis"
author: "Smaranjit Ghose, Soham Joshi, Vijay S Kalmath"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
github-repo: "VijayKalmath/USCrimeAnalysis"
description: "A detaled analysis of crime in the United States"
url: 'https://vijaykalmath.github.io/USCrimeAnalysis/'
cover-image: "./assets/cover.png"
favicon: "./assets/favicon.ico"
apple-touch-icon: "./assets/apple-touch-icon.png"
apple-touch-icon-size: 120
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```







# Introduction

In this project, we aim to analyze data related to crime in the United States while focusing on various aspects such as age,sex,race of offenders and victims, correlation between crime rate rise/fall and parallel political/social events and a deep dive into the current situation of public safety across the nation. The aim of the project is to draw insights that might be useful for drafting of policies regarding public safety or taking measures to prevent homicides as a whole.

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources

1. [FBI's Uniform Crime Reporting Program: Archives on Hate Crime](https://ucr.fbi.gov/hate-crime)

<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

```{R}
library(tidyverse)
library(patchwork)
library(ggplot2)
library(kableExtra)

```

## FBI: Uniform Crime Reporting (UCR)

The UCR data set consisted of year wise data of crime counts. The data was reported with respect to various parameters such as the cause of the crime, type of crime and also various demographics of victims and offenders. This was consolidated over 14 tables depending on the parameters. We selected 6 out of the 14 tables to analyse and visualize the crimes in the country during 2010-2019. 
For every year from 2010 - 2019, the source had a set of all tables with the following data:

1. Incidents, Offense, Victims and Known Offenders by Bias Motivation
2. Incidents, Offense, Victims and Known Offenders by Offense Type
3. Offenders, Offenses and Race/Ethnicity by Offense Type
4. Offenders and Race/Ethnicity by Age
5. Incident and Bias Motivation by Location
6. Offenses and Type of Offenses by State

Through these 6 tables we extract enough information to comment about certain trends of crime in the country based on geographic location, demographics of the offenders and demographics of the offenses. Since all the data is distributed over 10 years, we can also compare changes to important events.

### Hate Crime by Bias
We use the Incidents, Offense, Victims and Known Offenders by Bias Motivation data from 2010 to 2019. Since the two main statistics are the number of incidents and number of victims we only consider those over 10 years. We now get long form data structure with Bias type, Incidents, Victims and Year

```{R}
df <- read_csv("data/processed/ucr/FBI_UCR_TABLE1.csv",show_col_types = FALSE)
df %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "900px", height = "300px") 
```

### Hate Crime by Offense Type
Similarly we have data which  categorized by offense type instead of Bias. Here we can store two separate data tables for incidents and victims, since some types of offenses do not involve victims. (Or are against property and/or society)

Incidents: Crime and Years
```{R}
df <- read_csv("data/processed/ucr/FBI_UCR_TABLE2_Incidents.csv",show_col_types = FALSE)
df %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = T) %>% 
  scroll_box(width = "500px", height = "300px") 
```
Victims: Crime and Years
```{R}
df1 <- read_csv("data/processed/ucr/FBI_UCR_TABLE2_Victims.csv",show_col_types = FALSE)
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

### Hate Crime by State
```{R}
df1 <- read_csv("data/processed/ucr/annual_hc_by_state.csv",show_col_types = FALSE)
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

Similarly we also aggregate the other data for the other sources.

## Gun Violence Data

### Mass Shootings
For the Gun violence data, we had a consolidated data set for years 2018-2021 and separate data for every year from 2014 to 2017. We combine this data according to years
```{R}
df1 <- read_csv("data/processed/GVA/MassShootingTotalYears.csv",show_col_types = FALSE)
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

### Accidental Deaths and Injuries
We combine 3 data sets which have counts corresponding to Children, Teens and Adults as follows:

Accidental deaths:
```{R}
df1 <- read_csv("data/processed/GVA/Accidental_DeathsAll.csv",show_col_types = FALSE)
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

Accidental Injuries:
```{R}
df1 <- read_csv("data/processed/GVA/Accidental_InjuriesAll.csv",show_col_types = FALSE)
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

## Juvenile Arrest Records (JAR)
The JAR data set is a combined file of collated Juvenile arrest records by different aspects of race gender for years 1980 - 2019. We split this data according to gender and race. Due to the volume of the data we restrict our time frame to years 2000 - 2019.

Split by Gender:
```{R}
source("R_Scripts/readJar.R")
JuvenileList = readJar()

df1 = data.frame(JuvenileList[2])


df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```

Split by Race:
```{R}


df1 = data.frame(JuvenileList[3])
df1 %>%
  kable(escape = F) %>% 
  kable_styling("striped", font_size = 9, full_width = F) %>% 
  scroll_box(width = "500px", height = "300px") 
```


<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing Values

```{r}
# Import All Necessary Libraries
library(tidyverse)
library(patchwork)
library(repr)
library(ggnewscale)
library(RColorBrewer)
library(Lock5withR)
library(naniar)
library(ggplot2)

# Import Helper Libraries
source("R_Scripts/plot_missing.R")
source("R_Scripts/readJar.R")
source("R_Scripts/readGVA.R")
source("R_Scripts/readHC.R")

```

In this chapter , we take a deep look into the data that we have and analyze missing data patterns, furthermore we try to explain the reasoning behind the missing data.  

## Missing Data in Juvenile Arrest Records 

```{r,fig.align='center',fig.height=8,fig.width=8}
# Read Csv Files

JuvenileList = readJar()
JuvelineArrestdf = data.frame(JuvenileList[1])
JuvelineArrestGenderdf = data.frame(JuvenileList[2])
JuvelineArrestRacedf = data.frame(JuvenileList[3])
```


An Upset plot can be used to visualize the number of times certain variables are missing together with the other variables. This gives the combinations of variables which are missing. The vertical bar shows the intersection values of missing elements in the set. The horizontal bars show the set size of missing values in each variable. 
In this particular graph, the variables are years. The only variables which have missing values are years from 2010 through 2019. From the size of the set we can see that years 2013 - 2019 have equal number of missing values. 2010-2012 however, have fewer missing value. Hence we can see that there are two sets of overlaps. The height of the vertical bar shows the amount of missing data. We can see that there are 2 categories of crime which have missing data from 2013-2019 (left bar), and two categories of crime which have missing data from 2010-2019.

```{r,fig.align='center',fig.height=8,fig.width=8}
gg_miss_fct(x = JuvelineArrestdf, fct = Offense)  + coord_flip()
```

We can also look at the what percentage of values are missing from every variable. Unlike overlap, this gives us the absolute estimate of how much data we have missed. We can see that years 2013 to 2019 have the same amount of data missing as we concluded from the previous plot. Here we can see that it is little over 9% missing values of data per variable. Similarly, years 2010-2012 the percentage missing is even less. 

We plot the upset plot and the percentage missing values plot for the Juvenile Race records as well. We can see a similar trend in missing values in this. We can thus conclude that there is a gap in our data for 4 types of crimes and it is consistent throughout all classifications.

```{r,fig.align='center',fig.height=8,fig.width=8}

JuvenileArrestMissingPlot <- plot_missing(JuvelineArrestdf,percent = TRUE,xtickangle=90)
JuvenileArrestMissingPlot
```


## Missing Data in Gun Violence Archive

```{r,fig.align='center',fig.height=8,fig.width=8}
# Read Csv Files

GVAList = readGVA()

GVAMassShootingdf = data.frame(GVAList[1])
GVAAccidentalInjuriesdf = data.frame(GVAList[2])
GVAAccidentalDeathsdf = data.frame(GVAList[3])

colnames(GVAMassShootingdf) <- c("IncID","IncDate","State","County","Address", "Killed","Injured")

```

Stacked Bar plot to represent proportion of missing data in each column

```{r,fig.align='center',fig.height=8,fig.width=8}
missing_stacked_bar_plot(GVAMassShootingdf)
```

Missing Plot Matrix for GVA Data

```{r,fig.align='center',fig.height=8,fig.width=8}
GVAMassShootingPlot <- plot_missing(GVAMassShootingdf,percent = TRUE)
GVAMassShootingPlot
```


## Missing Data in Hate Crime Data 

```{r,fig.align='center',fig.height=8,fig.width=8}
# Read Csv Files
HCList = readHC()
# Order to Dataframes : HCbyOffensedf,HCbyStatedf,HCbyPlacedf,HCbyAgedf,HCTable1,HCTable2_Incidents,HCTable2_Victims,HCTable8

```

###  HC by Offense 
```{r,fig.align='center',fig.height=8,fig.width=8}
HCbyOffensedf = data.frame(HCList[1])
gg_miss_fct(x = HCbyOffensedf, fct = Offense) + coord_flip()
plot_missing(HCbyOffensedf,percent = TRUE)
```

###  HC by State 

```{r,fig.align='center',fig.height=8,fig.width=8}
HCbyStatedf = data.frame(HCList[2])
gg_miss_fct(x = HCbyStatedf, fct = States) + coord_flip()
plot_missing(HCbyStatedf,percent = TRUE)
```

###  HC by Place 

```{r,fig.align='center',fig.height=8,fig.width=8}
HCbyPlacedf = data.frame(HCList[3])
gg_miss_fct(x = HCbyPlacedf, fct = Place) + coord_flip()
plot_missing(HCbyPlacedf,percent = TRUE)
```

###  HC by Age 

```{r,fig.align='center',fig.height=8,fig.width=8}

HCbyAgedf = data.frame(HCList[4])
gg_miss_fct(x = HCbyAgedf, fct = AgeCategory) + coord_flip()
plot_missing(HCbyAgedf,percent = TRUE)

```



<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

